<?php

namespace JaguarJack\Generate\Build;

use PhpParser\Comment\Doc;
use PhpParser\Node\Stmt\Return_;

class ClassMethod extends Method
{

    /**
     * @var array
     */
    protected $methodBody;


    /**
     * @var bool
     */
    protected $return = false;

    /**
     * 设置方法名称
     *
     * @time 2021年06月01日
     * @param string $name
     * @throws \JaguarJack\Generate\Exceptions\TypeNotFoundException
     * @return ClassMethod
     */
    public static function name(string $name)
    {
        return new self($name);
    }


    /**
     *
     * @time 2021年06月01日
     * @return \PhpParser\Node|\PhpParser\Node\Stmt\ClassMethod
     */
    public function fetch()
    {
        if ($this->return) {
            $stmt = array_pop($this->methodBody);

            $stmt = new Return_($stmt);

            array_push($this->methodBody, $stmt);
        }

        $this->addStmts($this->methodBody);

        return $this->getNode();
    }


    /**
     *
     *
     * @time 2021年06月01日
     * @param \PhpParser\Builder\Param|\PhpParser\Node\Param|Params|array $param
     * @return ClassMethod
     */
    public function addParam($param): ClassMethod
    {
        if (is_array($param)) {
            foreach ($param as $p) {
                parent::addParam($p->fetch());
            }
        } else {
            parent::addParam($param->fetch()); // TODO: Change the autogenerated stub
        }

        return $this;
    }

    /**
     * 方法返回
     *
     * @time 2021年06月02日
     * @return $this
     */
    public function return(): ClassMethod
    {
        $this->return = true;

        return $this;
    }

    /**
     * 添加方法体
     *
     * @time 2021年06月01日
     * @param array $stmts
     * @return ClassMethod
     */
    public function body(array $stmts): ClassMethod
    {
       $this->methodBody = $stmts;

       return $this;
    }

    /**
     * 注释
     *
     * @time 2021年06月02日
     * @param $document
     * @return ClassMethod
     */
    public function document($document): ClassMethod
    {
        return $this->setDocComment(new Doc($document));
    }
}